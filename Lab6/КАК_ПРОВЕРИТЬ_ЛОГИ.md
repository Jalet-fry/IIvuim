# Как проверить логи Lab6

## 📋 Пошаговая инструкция

### Шаг 1: Пересоберите проект

В Qt Creator нажмите **Build → Rebuild All**

Или через терминал:
```bash
cd C:\QT_projects\IIvuim
qmake IIvuim.pro
mingw32-make
```

### Шаг 2: Запустите программу

```bash
.\release\SimpleLabsMenu.exe
```

### Шаг 3: Откройте Lab 6

Нажмите кнопку **"ЛР 6"** в главном меню

### Шаг 4: Логи создадутся автоматически

При открытии Lab6 сразу создастся:
- Папка `Lab6_BluetoothLogs` в Documents
- Подпапка `Session_<дата_время>`
- Файл `bluetooth_log.txt`

### Шаг 5: Найдите папку с логами

#### Вариант А: Через PowerShell
```powershell
# Откройте папку с логами
explorer.exe "$env:USERPROFILE\Documents\Lab6_BluetoothLogs"
```

#### Вариант Б: Вручную
1. Откройте **Проводник**
2. Перейдите в **Документы** (Documents)
3. Найдите папку **Lab6_BluetoothLogs**
4. Откройте последнюю папку **Session_...**

### Шаг 6: Откройте файл лога

Файл: `bluetooth_log.txt`

Откройте в:
- **Notepad++** (рекомендуется, поддержка UTF-8)
- **Блокнот** (может быть проблема с кириллицей)
- **VS Code**
- **Любой текстовый редактор**

## 📂 Структура логов

```
C:\Users\Vitos\Documents\
  └── Lab6_BluetoothLogs\
      ├── Session_20251014_212830\
      │   └── bluetooth_log.txt
      ├── Session_20251014_213045\
      │   └── bluetooth_log.txt
      └── Session_20251014_215622\
          └── bluetooth_log.txt
```

Каждый запуск Lab6 = новая сессия = новая папка.

## 📊 Что должно быть в логе

### Заголовок:
```
╔═══════════════════════════════════════════════════════════════╗
║          BLUETOOTH LAB6 - SESSION LOG                         ║
╚═══════════════════════════════════════════════════════════════╝

Session ID: 20251014_212830
Started: 2025-10-14 21:28:30
Log File: C:/Users/Vitos/Documents/Lab6_BluetoothLogs/Session_20251014_212830/bluetooth_log.txt

═══════════════════════════════════════════════════════════════
```

### Инициализация:
```
[21:28:30.123] [  INFO] [UI            ] ═══════════════════════════════════════
[21:28:30.124] [  INFO] [UI            ] BLUETOOTH WINDOW ИНИЦИАЛИЗАЦИЯ
[21:28:30.125] [  INFO] [UI            ] ═══════════════════════════════════════
[21:28:30.126] [  INFO] [UI            ] 
[21:28:30.127] [  INFO] [UI            ] Создание WindowsBluetoothManager...
[21:28:30.150] [  INFO] [Adapter       ] ═══════════════════════════════════════
[21:28:30.151] [  INFO] [Adapter       ] ИНФОРМАЦИЯ О BLUETOOTH АДАПТЕРЕ
[21:28:30.152] [  INFO] [Adapter       ] ═══════════════════════════════════════
[21:28:30.153] [  INFO] [Adapter       ] Имя: DESKTOP-ABC123
[21:28:30.154] [  INFO] [Adapter       ] MAC: 00:1A:7D:DA:71:13
[21:28:30.155] [  INFO] [Adapter       ] 
[21:28:30.156] [SUCCESS] [Adapter       ] ✓ Bluetooth адаптер АКТИВЕН!
```

### Сканирование:
```
[21:28:35.200] [  INFO] [Scan          ] ═══════════════════════════════════════
[21:28:35.201] [  INFO] [Scan          ] НАЧАЛО СКАНИРОВАНИЯ УСТРОЙСТВ
[21:28:35.202] [  INFO] [Scan          ] ═══════════════════════════════════════
[21:28:35.203] [ DEBUG] [Scan          ] Очистка таблицы устройств
[21:28:35.204] [  INFO] [Scan          ] Запуск сканирования через WinAPI...
[21:28:35.205] [  INFO] [Scan          ] 
```

### Найденные устройства:
```
[21:28:36.100] [  INFO] [Device        ] Sony WH-1000XM4 [38:18:4C:XX:XX:XX]: Найдено
[21:28:36.101] [  INFO] [Device        ] Logitech MX Master [5C:BA:37:XX:XX:XX]: Найдено
[21:28:36.102] [  INFO] [Device        ] Galaxy S20 [A4:C1:38:XX:XX:XX]: Найдено
```

### Отправка файла:
```
[21:28:50.500] [  INFO] [Send          ] ═══════════════════════════════════════
[21:28:50.501] [  INFO] [Send          ] ВЫБОР ФАЙЛА ДЛЯ ОТПРАВКИ
[21:28:50.502] [  INFO] [Send          ] ═══════════════════════════════════════
[21:28:50.503] [  INFO] [Send          ] Целевое устройство: Galaxy S20
[21:28:50.504] [  INFO] [Send          ] MAC адрес: A4:C1:38:XX:XX:XX
[21:28:50.505] [ DEBUG] [Send          ] Подключено: НЕТ
[21:28:50.506] [ DEBUG] [Send          ] Сопряжено: ДА
[21:28:50.507] [WARNING] [Send          ] ⚠ УСТРОЙСТВО НЕ ПОДКЛЮЧЕНО!
```

## 🔍 Проверка логов

### Проверка 1: Папка создалась?

```powershell
Test-Path "C:\Users\Vitos\Documents\Lab6_BluetoothLogs"
# Должно вернуть: True
```

### Проверка 2: Есть ли сессии?

```powershell
Get-ChildItem "C:\Users\Vitos\Documents\Lab6_BluetoothLogs"
# Должно показать: Session_<дата_время>
```

### Проверка 3: Есть ли файл лога?

```powershell
Get-ChildItem "C:\Users\Vitos\Documents\Lab6_BluetoothLogs\Session_*\bluetooth_log.txt"
# Должно показать файл bluetooth_log.txt
```

### Проверка 4: Содержимое лога

```powershell
# Показать первые 20 строк последнего лога
$latestLog = Get-ChildItem "C:\Users\Vitos\Documents\Lab6_BluetoothLogs\Session_*\bluetooth_log.txt" | 
             Sort-Object LastWriteTime -Descending | 
             Select-Object -First 1
Get-Content $latestLog -First 20 -Encoding UTF8
```

## ❓ Если логи не создаются

### Проблема 1: Папка Documents перенаправлена на OneDrive

Проверьте:
```powershell
[Environment]::GetFolderPath('MyDocuments')
```

Если показывает OneDrive, то логи будут там:
```
C:\Users\Vitos\OneDrive\Документы\Lab6_BluetoothLogs\
```

### Проблема 2: Нет прав на запись

Проверьте права доступа к папке Documents:
```powershell
(Get-Acl "$env:USERPROFILE\Documents").Access | 
    Where-Object {$_.IdentityReference -like "*$env:USERNAME*"}
```

### Проблема 3: Программа падает при инициализации

Проверьте консольный вывод программы - там должны быть ошибки Qt.

## 🎯 Быстрая проверка

### Однострочная команда для проверки:

```powershell
if (Test-Path "$env:USERPROFILE\Documents\Lab6_BluetoothLogs") {
    Write-Host "✓ Папка логов найдена!" -ForegroundColor Green
    $sessions = Get-ChildItem "$env:USERPROFILE\Documents\Lab6_BluetoothLogs\Session_*"
    Write-Host "Найдено сессий: $($sessions.Count)" -ForegroundColor Cyan
    $sessions | ForEach-Object { Write-Host "  - $($_.Name)" }
} else {
    Write-Host "✗ Папка логов НЕ найдена" -ForegroundColor Red
    Write-Host "Запустите Lab6 для создания логов" -ForegroundColor Yellow
}
```

## 📝 Что искать в логах

### Для отладки "сопряжено но не подключено":

Ищите строки:
```
[DEBUG] [Send] Подключено: НЕТ
[DEBUG] [Send] Сопряжено: ДА
```

### Для отладки проблем сканирования:

Ищите строки:
```
[WinAPI] API CALL: BluetoothFindFirstDevice
[WinAPI] API RESULT: ...
```

### Для проверки отправки файлов:

Ищите строки:
```
[FileSender] МЕТОД 1: Использование fsquirt.exe
[FileSender] ✓ Мастер отправки файлов запущен!
```

## 🎓 После первого запуска

1. Закройте Lab6
2. Откройте папку логов
3. Найдите `Session_<время>`
4. Откройте `bluetooth_log.txt`
5. Изучите логи

## 📋 Чек-лист

- [ ] Программа пересобрана
- [ ] Lab6 запущен
- [ ] Папка `Lab6_BluetoothLogs` создалась
- [ ] Папка `Session_<время>` создалась
- [ ] Файл `bluetooth_log.txt` существует
- [ ] Файл содержит логи
- [ ] Кодировка UTF-8 читается правильно
- [ ] Логи включают временные метки
- [ ] Логи показывают информацию об адаптере
- [ ] Логи показывают результаты сканирования

## ✅ Готово!

Теперь у вас есть полная система логирования для отладки Bluetooth!


