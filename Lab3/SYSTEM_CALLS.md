# –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã Windows API –≤ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ3

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—è–º–∏

### 1. **WMI (Windows Management Instrumentation)**
- **–ó–∞–ø—Ä–æ—Å**: `Win32_DiskDrive`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—è—Ö
- **–ü–æ–ª—É—á–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
  - –ú–æ–¥–µ–ª—å –¥–∏—Å–∫–∞
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å
  - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä
  - –í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏
  - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä

### 2. **DeviceIoControl + IOCTL_STORAGE_GET_DEVICE_NUMBER**
- **–§—É–Ω–∫—Ü–∏—è**: `DeviceIoControl()`
- **–ö–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏**: `IOCTL_STORAGE_GET_DEVICE_NUMBER`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–æ–≤ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –≠—Ç–æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫ –∫–∞–∫–æ–º—É —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É –¥–∏—Å–∫—É (PHYSICALDRIVE0, PHYSICALDRIVE1 –∏ —Ç.–¥.) –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫–∞–∂–¥—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ (C:, D: –∏ —Ç.–¥.)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```cpp
HANDLE hDevice = CreateFileW(L"\\\\.\\C:", 0, FILE_SHARE_READ | FILE_SHARE_WRITE, 
                             NULL, OPEN_EXISTING, 0, NULL);
STORAGE_DEVICE_NUMBER deviceNumber;
DWORD bytesReturned;

DeviceIoControl(hDevice, IOCTL_STORAGE_GET_DEVICE_NUMBER, NULL, 0,
                &deviceNumber, sizeof(deviceNumber), &bytesReturned, NULL);
// deviceNumber.DeviceNumber —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Å–∫–∞
```

### 3. **GetDiskFreeSpaceExW**
- **–§—É–Ω–∫—Ü–∏—è**: `GetDiskFreeSpaceExW()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤–æ–±–æ–¥–Ω–æ–º –∏ –∑–∞–Ω—è—Ç–æ–º –º–µ—Å—Ç–µ –Ω–∞ –¥–∏—Å–∫–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
  - –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞
  - –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
  - –î–æ—Å—Ç—É–ø–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–µ—Å—Ç–æ

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```cpp
ULARGE_INTEGER freeBytesAvailable;
ULARGE_INTEGER totalNumberOfBytes;
ULARGE_INTEGER totalNumberOfFreeBytes;

GetDiskFreeSpaceExW(L"C:\\", &freeBytesAvailable, 
                    &totalNumberOfBytes, &totalNumberOfFreeBytes);
```

### 4. **GetLogicalDrives**
- **–§—É–Ω–∫—Ü–∏—è**: `GetLogicalDrives()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–∏ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–æ–≤
- **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞, –≥–¥–µ –∫–∞–∂–¥—ã–π –±–∏—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –±—É–∫–≤—É –¥–∏—Å–∫–∞ (A-Z)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```cpp
DWORD driveMask = GetLogicalDrives();
for (int i = 0; i < 26; i++) {
    if (driveMask & (1 << i)) {
        // –î–∏—Å–∫ —Å –±—É–∫–≤–æ–π ('A' + i) —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    }
}
```

### 5. **CreateFileW**
- **–§—É–Ω–∫—Ü–∏—è**: `CreateFileW()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ DeviceIoControl

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```cpp
HANDLE hDevice = CreateFileW(
    L"\\\\.\\C:",                        // –ü—É—Ç—å –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
    0,                                    // –î–æ—Å—Ç—É–ø (0 –¥–ª—è DeviceIoControl)
    FILE_SHARE_READ | FILE_SHARE_WRITE,  // –†–µ–∂–∏–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
    NULL,                                 // –ê—Ç—Ä–∏–±—É—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    OPEN_EXISTING,                        // –û—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    0,                                    // –§–ª–∞–≥–∏
    NULL                                  // –®–∞–±–ª–æ–Ω
);
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **WMI –∑–∞–ø—Ä–æ—Å** –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–µ–π –∏ –∏—Ö –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Å–∫–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0 –∏–∑ "PHYSICALDRIVE0")
3. **GetLogicalDrives** –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å–∫–æ–≤ (C:, D:, –∏ —Ç.–¥.)
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Å–∫–∞:
   - **CreateFileW** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - **DeviceIoControl** —Å `IOCTL_STORAGE_GET_DEVICE_NUMBER` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É –¥–∏—Å–∫—É
   - –ï—Å–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω—É–∂–Ω–æ–º—É —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É:
     - **GetDiskFreeSpaceExW** –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–±–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
5. –°—É–º–º–∏—Ä—É–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ —Å–æ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Å–∫–∞

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä—è–º—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: –ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –¥—Ä–∞–π–≤–µ—Ä–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤  
‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ WMI –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–ª–æ—ë–≤  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º  

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å WMI-only –ø–æ–¥—Ö–æ–¥–æ–º

| –ö—Ä–∏—Ç–µ—Ä–∏–π | WMI-only | –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã |
|----------|----------|------------------|
| –°–ª–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É—Ç–µ–π | ‚ùå –í—ã—Å–æ–∫–∞—è | ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ | ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å | ‚úÖ –í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | üî∂ –°—Ä–µ–¥–Ω—è—è | ‚úÖ –í—ã—Å–æ–∫–∞—è |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç WMI | ‚ùå –ü–æ–ª–Ω–∞—è | üî∂ –ß–∞—Å—Ç–∏—á–Ω–∞—è (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è) |


