═══════════════════════════════════════════════════════════════════════════════
                   LAB 5 - МОНИТОРИНГ USB-УСТРОЙСТВ
═══════════════════════════════════════════════════════════════════════════════

ОПИСАНИЕ:
─────────
Программа для мониторинга USB-устройств в реальном времени с возможностью
безопасного извлечения.

ВОЗМОЖНОСТИ:
────────────
✓ Автоматическое обнаружение новых USB-устройств
✓ Отображение информации о всех подключенных устройствах
✓ Безопасное извлечение съемных устройств
✓ Мониторинг событий подключения/отключения
✓ Различение безопасного и небезопасного отключения
✓ Подробный журнал всех операций

БЫСТРЫЙ СТАРТ:
──────────────
1. Запустите приложение
2. В главном меню нажмите кнопку "ЛР 5"
3. Откроется окно мониторинга USB-устройств
4. В таблице отобразятся все подключенные USB-устройства

КАК ПОДКЛЮЧИТЬ УСТРОЙСТВО:
───────────────────────────
1. Вставьте USB-устройство (мышь, флешку, клавиатуру и т.д.)
2. Устройство автоматически появится в таблице
3. В журнале отобразится событие:
   → Подключено: [Имя устройства] [PID: XXXX]

КАК БЕЗОПАСНО ИЗВЛЕЧЬ УСТРОЙСТВО:
──────────────────────────────────
1. В таблице выберите устройство, которое хотите извлечь
2. Проверьте, что в колонке "Извлекаемое" стоит "Да" (зеленым цветом)
3. Нажмите кнопку "Безопасно извлечь"
4. Подтвердите операцию в диалоге
5. Дождитесь сообщения в журнале:
   ✓ БЕЗОПАСНО ИЗВЛЕЧЕНО: [Имя устройства]
6. Теперь можно физически отключить устройство

ВАЖНО!
──────
⚠ Перед извлечением флешки:
  - Закройте все файлы с флешки
  - Закройте проводник, если он открыт на флешке
  - Закройте все программы, использующие флешку

⚠ Системные устройства (мышь, клавиатура):
  - Помечены как "Нет" в колонке "Извлекаемое" (красным)
  - Не могут быть безопасно извлечены
  - Это нормальное поведение для защиты системы

ТИПЫ УСТРОЙСТВ:
───────────────
🟢 ИЗВЛЕКАЕМЫЕ (Да):
   - USB-флешки
   - Внешние жесткие диски
   - USB-адаптеры
   - Кард-ридеры
   → Можно безопасно извлечь

🔴 НЕИЗВЛЕКАЕМЫЕ (Нет):
   - USB-мышь
   - USB-клавиатура
   - Веб-камера
   - Другие устройства ввода
   → Нельзя извлечь (системные)

СОБЫТИЯ В ЖУРНАЛЕ:
───────────────────
→ Подключено:           Новое устройство подключено
← Безопасно отключено:  Устройство безопасно извлечено и отключено
⚠ Небезопасно отключено: Устройство отключено без безопасного извлечения
✓ БЕЗОПАСНО ИЗВЛЕЧЕНО:  Операция безопасного извлечения успешна
✗ ОШИБКА ИЗВЛЕЧЕНИЯ:    Не удалось безопасно извлечь (закройте файлы)
✗ ОТКАЗ В ИЗВЛЕЧЕНИИ:   Система отказала в извлечении (устройство занято)

КНОПКИ УПРАВЛЕНИЯ:
──────────────────
[Обновить список]     - Обновить таблицу устройств
[Безопасно извлечь]   - Извлечь выбранное устройство
[Очистить журнал]     - Очистить журнал событий
[Назад]               - Вернуться в главное меню

ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:
──────────────────────

ПРИМЕР 1: Безопасное извлечение флешки
───────────────────────────────────────
1. Вставляем флешку
   → Журнал: "→ Подключено: Kingston DataTraveler [PID: 1234]"
   
2. Работаем с файлами, затем закрываем их все

3. Выбираем флешку в таблице, жмем "Безопасно извлечь"
   → Журнал: "Попытка извлечения: Kingston DataTraveler"
   → Журнал: "✓ БЕЗОПАСНО ИЗВЛЕЧЕНО: Kingston DataTraveler"
   
4. Вынимаем флешку
   → Журнал: "← Безопасно отключено: Kingston DataTraveler [PID: 1234]"

✓ Результат: Флешка безопасно извлечена, данные не повреждены

ПРИМЕР 2: Попытка извлечения мыши
──────────────────────────────────
1. Выбираем USB-мышь в таблице
   → Кнопка "Безопасно извлечь" неактивна (серая)
   
2. Пытаемся извлечь
   → Появляется сообщение: "Устройство нельзя извлечь"
   
✓ Результат: Система защищена от случайного извлечения мыши

ПРИМЕР 3: Ошибка извлечения (файл открыт)
──────────────────────────────────────────
1. Открываем файл с флешки в Notepad

2. Пытаемся извлечь флешку
   → Журнал: "Попытка извлечения: Kingston DataTraveler"
   → Журнал: "✗ ОШИБКА ИЗВЛЕЧЕНИЯ: Kingston DataTraveler"
   → Диалог: "Не удалось безопасно извлечь устройство..."
   
3. Закрываем файл в Notepad

4. Повторяем извлечение - теперь успешно
   → Журнал: "✓ БЕЗОПАСНО ИЗВЛЕЧЕНО: Kingston DataTraveler"

✓ Результат: Данные защищены, извлечение произведено после закрытия файлов

ПРИМЕР 4: Небезопасное отключение
──────────────────────────────────
1. Вставляем флешку
   → Журнал: "→ Подключено: Kingston DataTraveler [PID: 1234]"
   
2. Сразу вынимаем флешку БЕЗ безопасного извлечения
   → Журнал: "⚠ Небезопасно отключено: Kingston DataTraveler [PID: 1234]"
   → Windows может показать предупреждение

⚠ Результат: Возможна потеря данных!

ТЕХНИЧЕСКИЕ ДЕТАЛИ:
───────────────────
- Используется Windows API для работы с устройствами
- Мониторинг работает в отдельном потоке
- События обрабатываются в реальном времени
- Поддержка модифицированных устройств (несколько разделов)

СИСТЕМНЫЕ ТРЕБОВАНИЯ:
──────────────────────
- Windows 7 и выше
- Для некоторых операций могут потребоваться права администратора

РЕШЕНИЕ ПРОБЛЕМ:
─────────────────

Проблема: Устройство не определяется
Решение:
  1. Проверьте физическое подключение
  2. Нажмите "Обновить список"
  3. Проверьте Device Manager в Windows
  4. Перезапустите окно Lab 5

Проблема: Не работает безопасное извлечение
Решение:
  1. Закройте все файлы с устройства
  2. Закройте проводник
  3. Закройте все программы
  4. Повторите попытку
  5. Если не помогает - запустите программу от имени администратора

Проблема: Появляется "Отказ в извлечении"
Решение:
  1. Откройте диспетчер задач
  2. Найдите процессы, использующие устройство
  3. Завершите эти процессы
  4. Повторите извлечение

ПОЛЕЗНЫЕ СОВЕТЫ:
─────────────────
💡 Всегда используйте безопасное извлечение для флешек
💡 Следите за журналом - он покажет все проблемы
💡 Зеленый цвет = можно извлечь, красный = нельзя
💡 При множественных разделах извлекаются все сразу
💡 Не закрывайте окно во время операции извлечения

ДЕМОНСТРАЦИЯ ДЛЯ ПРОВЕРКИ:
───────────────────────────
Для полной демонстрации функционала:

1. Подключите USB-мышь
   ✓ Проверка: Мышь появилась в списке, помечена красным "Нет"
   
2. Подключите USB-флешку  
   ✓ Проверка: Флешка появилась в списке, помечена зеленым "Да"
   
3. Попробуйте извлечь мышь
   ✓ Проверка: Кнопка неактивна или выдает ошибку
   
4. Откройте файл с флешки, попробуйте извлечь
   ✓ Проверка: Выдает ошибку "устройство занято"
   
5. Закройте файл, безопасно извлеките флешку
   ✓ Проверка: Успешное извлечение, сообщение в журнале
   
6. Отключите флешку физически
   ✓ Проверка: Сообщение "Безопасно отключено"
   
7. Подключите флешку снова, сразу выдерните
   ✓ Проверка: Сообщение "⚠ Небезопасно отключено"

═══════════════════════════════════════════════════════════════════════════════
                              УСПЕХОВ В РАБОТЕ!
═══════════════════════════════════════════════════════════════════════════════

