# Инструкция по тестированию Lab 5

## Подготовка к тестированию

### Необходимое оборудование:
1. USB-мышь (или другая USB-периферия)
2. USB-флешка (или другой съемный накопитель)

### Системные требования:
- Windows 7 или выше
- Права администратора для безопасного извлечения устройств

## Тестовые сценарии

### Сценарий 1: Запуск и начальная инициализация

**Шаги:**
1. Запустить приложение
2. Открыть главное меню
3. Нажать кнопку "ЛР 5"

**Ожидаемый результат:**
- Открывается окно "Lab 5 - USB Мониторинг"
- В журнале появляется сообщение "=== Система мониторинга USB-устройств запущена ==="
- Таблица устройств показывает все подключенные USB-устройства
- Отображается инструкция по использованию

### Сценарий 2: Отображение текущих устройств

**Шаги:**
1. Открыть окно Lab 5
2. Просмотреть таблицу устройств

**Ожидаемый результат:**
- В таблице отображаются все подключенные USB-устройства
- Для каждого устройства показано:
  - Номер по порядку
  - Имя устройства
  - PID (идентификатор продукта)
  - Статус возможности извлечения (Да/Нет)
- Извлекаемые устройства отмечены зеленым
- Неизвлекаемые устройства отмечены красным

### Сценарий 3: Подключение USB-мыши

**Шаги:**
1. Открыть окно Lab 5
2. Отключить USB-мышь от компьютера
3. Подождать 2-3 секунды
4. Подключить USB-мышь обратно

**Ожидаемый результат:**
- При подключении:
  - В журнале появляется сообщение "→ Подключено: [Имя мыши] [PID: XXXX]"
  - Устройство появляется в таблице
  - Мышь помечена как "Нет" в столбце "Извлекаемое" (красным)
  - Статусная строка обновляется с новым количеством устройств

### Сценарий 4: Подключение USB-флешки

**Шаги:**
1. Открыть окно Lab 5
2. Вставить USB-флешку

**Ожидаемый результат:**
- В журнале появляется сообщение "→ Подключено: [Имя флешки] [PID: XXXX]"
- Флешка появляется в таблице
- Флешка помечена как "Да" в столбце "Извлекаемое" (зеленым)
- Статусная строка обновляется

### Сценарий 5: Попытка извлечения неизвлекаемого устройства (мышь)

**Шаги:**
1. Открыть окно Lab 5
2. Выбрать USB-мышь в таблице
3. Нажать кнопку "Безопасно извлечь"

**Ожидаемый результат:**
- Кнопка "Безопасно извлечь" остается неактивной (disabled)
- При попытке извлечения появляется сообщение:
  "Устройство нельзя безопасно извлечь. Это может быть системное устройство."
- В журнале появляется сообщение о невозможности извлечения

### Сценарий 6: Безопасное извлечение USB-флешки

**Предусловия:**
- Все файлы на флешке закрыты
- Проводник не открыт на флешке
- Никакие программы не используют флешку

**Шаги:**
1. Открыть окно Lab 5
2. Выбрать USB-флешку в таблице
3. Нажать кнопку "Безопасно извлечь"
4. Подтвердить операцию в диалоге
5. Подождать завершения операции
6. Физически отключить флешку

**Ожидаемый результат:**
- Кнопка "Безопасно извлечь" активна
- Появляется диалог подтверждения
- В журнале появляется "Попытка извлечения: [Имя флешки]"
- В журнале появляется "✓ БЕЗОПАСНО ИЗВЛЕЧЕНО: [Имя флешки]"
- При физическом отключении:
  - В журнале появляется "← Безопасно отключено: [Имя флешки] [PID: XXXX]"
  - Устройство исчезает из таблицы

### Сценарий 7: Отказ в безопасном извлечении

**Предусловия:**
- На флешке открыт файл в каком-либо приложении
- ИЛИ проводник открыт на флешке

**Шаги:**
1. Открыть файл с флешки в Notepad или другой программе
2. В окне Lab 5 выбрать флешку
3. Нажать "Безопасно извлечь"
4. Подтвердить операцию

**Ожидаемый результат:**
- В журнале появляется "✗ ОШИБКА ИЗВЛЕЧЕНИЯ: [Имя флешки]"
- Появляется диалог с сообщением:
  "Не удалось безопасно извлечь устройство. Устройство может использоваться системой или приложением."
- Устройство остается в таблице

### Сценарий 8: Небезопасное отключение USB-флешки

**Шаги:**
1. Открыть окно Lab 5
2. Вставить USB-флешку
3. НЕ делая безопасное извлечение, физически отключить флешку

**Ожидаемый результат:**
- В журнале появляется "⚠ Небезопасно отключено: [Имя флешки] [PID: XXXX]"
- Устройство исчезает из таблицы
- Windows может показать системное предупреждение о небезопасном извлечении

### Сценарий 9: Работа с модифицированным устройством

**Предусловия:**
- USB-флешка с несколькими разделами
- ИЛИ устройство, определяемое как CD-ROM + Flash

**Шаги:**
1. Подключить модифицированное устройство
2. Проверить отображение в таблице

**Ожидаемый результат:**
- Устройство корректно определяется
- Можно выполнить безопасное извлечение
- Все разделы извлекаются одновременно

### Сценарий 10: Обновление списка устройств

**Шаги:**
1. Открыть окно Lab 5
2. Подключить/отключить любое USB-устройство
3. Нажать кнопку "Обновить список"

**Ожидаемый результат:**
- Таблица обновляется с текущим списком устройств
- В журнале появляется "Список устройств обновлен"
- Статусная строка показывает актуальное количество

### Сценарий 11: Очистка журнала

**Шаги:**
1. Открыть окно Lab 5
2. Выполнить несколько операций (подключить/отключить устройства)
3. Нажать кнопку "Очистить журнал"

**Ожидаемый результат:**
- Журнал очищается
- Остается только сообщение "Журнал очищен"

### Сценарий 12: Множественные устройства

**Шаги:**
1. Открыть окно Lab 5
2. Подключить несколько USB-устройств одновременно:
   - USB-флешку
   - USB-мышь
   - USB-клавиатуру (если есть)

**Ожидаемый результат:**
- Все устройства корректно определяются
- Каждое устройство отображается в отдельной строке таблицы
- События подключения логируются для каждого устройства
- Можно работать с каждым устройством независимо

### Сценарий 13: Долговременная работа

**Шаги:**
1. Открыть окно Lab 5
2. Оставить окно открытым на 10-15 минут
3. Периодически подключать/отключать устройства

**Ожидаемый результат:**
- Приложение работает стабильно
- Все события корректно отслеживаются
- Нет утечек памяти
- UI остается отзывчивым

### Сценарий 14: Закрытие приложения

**Шаги:**
1. Открыть окно Lab 5
2. Подключить несколько устройств
3. Нажать кнопку "Назад" или закрыть окно

**Ожидаемый результат:**
- Окно закрывается корректно
- Поток мониторинга останавливается
- В журнале появляется "Мониторинг USB-устройств остановлен"
- Ресурсы освобождаются

## Проверка требований

### ✓ Отслеживание появления нового USB-устройства
- Сценарии 3, 4, 12

### ✓ События безопасного извлечения
- Сценарий 6

### ✓ События небезопасного извлечения
- Сценарий 8

### ✓ Отказ в безопасном извлечении
- Сценарий 7

### ✓ Возможность программного безопасного извлечения
- Сценарий 6

### ✓ Работа с модифицированными USB устройствами
- Сценарий 9

### ✓ Демонстрация работы с мышью
- Сценарии 3, 5

### ✓ Демонстрация работы с флешкой
- Сценарии 4, 6, 7, 8

## Критерии приемки

| Критерий | Статус |
|----------|--------|
| Автоматическое обнаружение новых устройств | ✓ |
| Отображение информации об устройствах | ✓ |
| Безопасное извлечение извлекаемых устройств | ✓ |
| Обработка отказа в извлечении | ✓ |
| Различение безопасного/небезопасного отключения | ✓ |
| Работа с множественными устройствами | ✓ |
| Корректная работа с модифицированными устройствами | ✓ |
| Стабильная работа при долговременном использовании | ✓ |
| Журналирование всех событий | ✓ |
| Удобный пользовательский интерфейс | ✓ |

## Известные ограничения

1. **Права доступа:**
   - Для безопасного извлечения некоторых устройств могут потребоваться права администратора

2. **Системные устройства:**
   - USB-мышь, клавиатура и другие устройства ввода не могут быть безопасно извлечены
   - Это ожидаемое поведение для защиты системы

3. **Задержка обнаружения:**
   - Между физическим подключением и обнаружением системой может пройти 1-2 секунды
   - Это нормально для Windows API

4. **Windows только:**
   - Код использует Windows API и работает только на Windows

## Рекомендации по отладке

### Если устройство не определяется:
1. Проверьте, что устройство корректно подключено
2. Проверьте Device Manager в Windows
3. Нажмите "Обновить список"
4. Перезапустите окно Lab 5

### Если не работает безопасное извлечение:
1. Закройте все программы, использующие устройство
2. Закройте проводник, если он открыт на устройстве
3. Проверьте права доступа
4. Попробуйте запустить приложение от имени администратора

### Для отладки в коде:
1. Включите отладочный вывод в QDebug
2. Проверьте журнал событий Windows
3. Используйте отладчик для трассировки вызовов Windows API

## Заключение

Все тестовые сценарии должны успешно выполняться для подтверждения корректной работы Lab 5.
При возникновении проблем обратитесь к разделу "Рекомендации по отладке" или документации Windows API.

